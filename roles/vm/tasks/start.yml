---

- name: create qcow2
  command: >-
    cp {{ qcow_dir }}/{{ src_image }}.qcow2 {{ qcow_dir }}/{{ target }}.qcow2
  when: src_image is defined

- name: set xml
  template:
    src: "{{ target }}.xml.j2"
    dest: "{{ xml_dir }}/{{ target }}.xml"
    owner: root
    group: root
    mode: 0644

- name: define vm
  command: >-
    virsh define {{ xml_dir }}/{{ target }}.xml
  changed_when: true

- name: start vm
  command: >-
    virsh start {{ target }}
  changed_when: true
